import{K as se,d as _,L as I,h as r,M as ue,u as H,O as de,c as L,j as ce,Q as q,R as pe,F as y,N as ve,b as V,U,a as D,V as fe,X as me,g as G,Y as he,s as C,Z as F,$ as ge,a0 as ke,k as O,o as z,l as g,a1 as we,q as xe,r as ye,t as be,v as n,w as o,x as l,B as b,E as x,H as Ce,D as N,G as M,z as _e,A as Pe,W as Ne,C as B,_ as Te}from"./index-CRohp2SC.js";import{N as ze,a as Oe,m}from"./discrete-DXjZWrr3.js";import{u as E,W as Se,o as je,N as Be,b as Me,d as S,e as Re,a as R,R as Le}from"./RefreshOutline-D5N7YCoz.js";import{S as Ue}from"./SearchOutline-DXmY8nqE.js";import{N as $e,a as T,b as W,c as Ie}from"./Switch-RMWSrnaP.js";import{F as A}from"./FlashOutline-BAnBUJVf.js";import{N as qe}from"./DataTable-C-sc0ToA.js";const Q=se("n-popconfirm"),X={positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0}},K=pe(X),Ve=_({name:"NPopconfirmPanel",props:X,setup(c){const{localeRef:i}=E("Popconfirm"),{inlineThemeDisabled:s}=H(),{mergedClsPrefixRef:p,mergedThemeRef:w,props:f}=de(Q),j=L(()=>{const{common:{cubicBezierEaseInOut:d},self:{fontSize:h,iconSize:k,iconColor:P}}=w.value;return{"--n-bezier":d,"--n-font-size":h,"--n-icon-size":k,"--n-icon-color":P}}),v=s?ce("popconfirm-panel",void 0,j,f):void 0;return Object.assign(Object.assign({},E("Popconfirm")),{mergedClsPrefix:p,cssVars:s?void 0:j,localizedPositiveText:L(()=>c.positiveText||i.value.positiveText),localizedNegativeText:L(()=>c.negativeText||i.value.negativeText),positiveButtonProps:q(f,"positiveButtonProps"),negativeButtonProps:q(f,"negativeButtonProps"),handlePositiveClick(d){c.onPositiveClick(d)},handleNegativeClick(d){c.onNegativeClick(d)},themeClass:v?.themeClass,onRender:v?.onRender})},render(){var c;const{mergedClsPrefix:i,showIcon:s,$slots:p}=this,w=I(p.action,()=>this.negativeText===null&&this.positiveText===null?[]:[this.negativeText!==null&&r(y,Object.assign({size:"small",onClick:this.handleNegativeClick},this.negativeButtonProps),{default:()=>this.localizedNegativeText}),this.positiveText!==null&&r(y,Object.assign({size:"small",type:"primary",onClick:this.handlePositiveClick},this.positiveButtonProps),{default:()=>this.localizedPositiveText})]);return(c=this.onRender)===null||c===void 0||c.call(this),r("div",{class:[`${i}-popconfirm__panel`,this.themeClass],style:this.cssVars},ue(p.default,f=>s||f?r("div",{class:`${i}-popconfirm__body`},s?r("div",{class:`${i}-popconfirm__icon`},I(p.icon,()=>[r(ve,{clsPrefix:i},{default:()=>r(Se,null)})])):null,f):null),w?r("div",{class:[`${i}-popconfirm__action`]},w):null)}}),De=V("popconfirm",[U("body",`
 font-size: var(--n-font-size);
 display: flex;
 align-items: center;
 flex-wrap: nowrap;
 position: relative;
 `,[U("icon",`
 display: flex;
 font-size: var(--n-icon-size);
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 margin: 0 8px 0 0;
 `)]),U("action",`
 display: flex;
 justify-content: flex-end;
 `,[D("&:not(:first-child)","margin-top: 8px"),V("button",[D("&:not(:last-child)","margin-right: 8px;")])])]),Fe=Object.assign(Object.assign(Object.assign({},G.props),ge),{positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},trigger:{type:String,default:"click"},positiveButtonProps:Object,negativeButtonProps:Object,onPositiveClick:Function,onNegativeClick:Function}),Ee=_({name:"Popconfirm",props:Fe,slots:Object,__popover__:!0,setup(c){const{mergedClsPrefixRef:i}=H(),s=G("Popconfirm","-popconfirm",De,he,c,i),p=C(null);function w(v){var d;if(!(!((d=p.value)===null||d===void 0)&&d.getMergedShow()))return;const{onPositiveClick:h,"onUpdate:show":k}=c;Promise.resolve(h?h(v):!0).then(P=>{var a;P!==!1&&((a=p.value)===null||a===void 0||a.setShow(!1),k&&F(k,!1))})}function f(v){var d;if(!(!((d=p.value)===null||d===void 0)&&d.getMergedShow()))return;const{onNegativeClick:h,"onUpdate:show":k}=c;Promise.resolve(h?h(v):!0).then(P=>{var a;P!==!1&&((a=p.value)===null||a===void 0||a.setShow(!1),k&&F(k,!1))})}return ke(Q,{mergedThemeRef:s,mergedClsPrefixRef:i,props:c}),{setShow(v){var d;(d=p.value)===null||d===void 0||d.setShow(v)},syncPosition(){var v;(v=p.value)===null||v===void 0||v.syncPosition()},mergedTheme:s,popoverInstRef:p,handlePositiveClick:w,handleNegativeClick:f}},render(){const{$slots:c,$props:i,mergedTheme:s}=this;return r(fe,Object.assign({},je(i,K),{theme:s.peers.Popover,themeOverrides:s.peerOverrides.Popover,internalExtraClass:["popconfirm"],ref:"popoverInstRef"}),{trigger:c.trigger,default:()=>{const p=me(i,K);return r(Ve,Object.assign({},p,{onPositiveClick:this.handlePositiveClick,onNegativeClick:this.handleNegativeClick}),c)}})}}),We={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=_({name:"AddOutline",render:function(i,s){return z(),O("svg",We,s[0]||(s[0]=[g("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),g("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1)]))}}),Ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},He=_({name:"CreateOutline",render:function(i,s){return z(),O("svg",Ke,s[0]||(s[0]=[g("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),g("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),g("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1)]))}}),Ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Qe=_({name:"LinkOutline",render:function(i,s){return z(),O("svg",Ge,s[0]||(s[0]=[g("path",{d:"M208 352h-64a96 96 0 0 1 0-192h64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),g("path",{d:"M304 160h64a96 96 0 0 1 0 192h-64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),g("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36",d:"M163.29 256h187.42"},null,-1)]))}}),Xe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ye=_({name:"PauseOutline",render:function(i,s){return z(),O("svg",Xe,s[0]||(s[0]=[g("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 96h16v320h-16z"},null,-1),g("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 96h16v320h-16z"},null,-1)]))}}),Ze={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Je=_({name:"PlayOutline",render:function(i,s){return z(),O("svg",Ze,s[0]||(s[0]=[g("path",{d:"M112 111v290c0 17.44 17 28.52 31 20.16l247.9-148.37c12.12-7.25 12.12-26.33 0-33.58L143 90.84c-14-8.36-31 2.72-31 20.16z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},tt=_({name:"TrashOutline",render:function(i,s){return z(),O("svg",et,s[0]||(s[0]=[we('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6)]))}}),lt={class:"tasks-page"},nt="留空使用系统默认提示词。支持占位符: {task_name}, {url}, {description}, {changes}",rt=_({__name:"Tasks",setup(c){const i=xe(),s=ye(),p=C(!0),w=C(""),f=C("all"),j=[{label:"全部状态",value:"all"},{label:"已启用",value:"enabled"},{label:"已禁用",value:"disabled"},{label:"有错误",value:"error"}],v=L(()=>{let e=[...i.tasks];if(w.value){const t=w.value.toLowerCase();e=e.filter(u=>u.name.toLowerCase().includes(t)||u.url.toLowerCase().includes(t)||u.description.toLowerCase().includes(t))}if(f.value&&f.value!=="all")switch(f.value){case"enabled":e=e.filter(t=>t.enabled);break;case"disabled":e=e.filter(t=>!t.enabled);break;case"error":e=e.filter(t=>t.error_count>0);break}return e}),d=C(!1),h=C("add"),k=C(null),P=C(null),a=C({url:"",name:"",description:"",selectors:"",interval:300,timeout:3e4,enabled:!0,ai_prompt:""}),Y={url:[{required:!0,message:"请输入网页URL",trigger:"blur"},{validator:(e,t)=>t&&!t.startsWith("http://")&&!t.startsWith("https://")?new Error("URL必须以 http:// 或 https:// 开头"):!0,trigger:"blur"}],name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:1,max:100,message:"任务名称长度应在1-100之间",trigger:"blur"}],interval:[{required:!0,type:"number",message:"请输入检测间隔",trigger:"blur"}],timeout:[{required:!0,type:"number",message:"请输入超时时间",trigger:"blur"}]},Z=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return e}},J=e=>e<60?`${e}秒`:e<3600?`${Math.floor(e/60)}分钟`:`${Math.floor(e/3600)}小时`,ee=[{title:"任务名称",key:"name",width:180,ellipsis:{tooltip:!0},render:e=>r(b,{align:"center"},{default:()=>[r("span",{style:{fontWeight:500}},e.name),e.error_count>0&&r(B,{},{trigger:()=>r(x,{color:"#e88080",size:16},{default:()=>r(A)}),default:()=>e.last_error_message||"任务存在错误"})]})},{title:"URL",key:"url",width:250,ellipsis:{tooltip:!0},render:e=>r(b,{align:"center"},{default:()=>[r(x,{size:14,color:"#63e2b7"},{default:()=>r(Qe)}),r("span",{style:{fontSize:"13px"}},e.url)]})},{title:"状态",key:"status",width:90,render:e=>e.enabled?e.error_count>0?r(R,{type:"error",size:"small"},{default:()=>"错误"}):r(R,{type:"success",size:"small"},{default:()=>"正常"}):r(R,{type:"default",size:"small"},{default:()=>"已禁用"})},{title:"检测间隔",key:"interval",width:100,render:e=>J(e.interval)},{title:"最后检测",key:"last_check",width:120,render:e=>Z(e.last_check)},{title:"变化次数",key:"change_count",width:90,align:"center"},{title:"操作",key:"actions",width:200,fixed:"right",render:e=>r(b,{size:"small"},{default:()=>[r(B,{},{trigger:()=>r(y,{size:"small",quaternary:!0,type:e.enabled?"warning":"success",onClick:()=>oe(e)},{icon:()=>r(x,{},{default:()=>r(e.enabled?Ye:Je)})}),default:()=>e.enabled?"禁用":"启用"}),r(B,{},{trigger:()=>r(y,{size:"small",quaternary:!0,type:"info",onClick:()=>ae(e)},{icon:()=>r(x,{},{default:()=>r(A)})}),default:()=>"立即检测"}),r(B,{},{trigger:()=>r(y,{size:"small",quaternary:!0,type:"primary",onClick:()=>ne(e)},{icon:()=>r(x,{},{default:()=>r(He)})}),default:()=>"编辑"}),r(Ee,{onPositiveClick:()=>ie(e)},{trigger:()=>r(y,{size:"small",quaternary:!0,type:"error"},{icon:()=>r(x,{},{default:()=>r(tt)})}),default:()=>`确定要删除任务 "${e.name}" 吗？`})]})}],$=async()=>{p.value=!0;try{await i.fetchTasks()}finally{p.value=!1}},te=async()=>{await $(),m.success("刷新成功")},le=()=>{h.value="add",k.value=null,a.value={url:"",name:"",description:"",selectors:"",interval:300,timeout:3e4,enabled:!0,ai_prompt:""},d.value=!0},ne=e=>{h.value="edit",k.value=e,a.value={url:e.url,name:e.name,description:e.description,selectors:e.selectors.join(", "),interval:e.interval,timeout:e.timeout,enabled:e.enabled,ai_prompt:e.ai_prompt},d.value=!0},re=async()=>{try{await P.value?.validate()}catch{return}const e={url:a.value.url,name:a.value.name,description:a.value.description,selectors:a.value.selectors?a.value.selectors.split(",").map(t=>t.trim()).filter(Boolean):[],interval:a.value.interval,timeout:a.value.timeout,enabled:a.value.enabled,ai_prompt:a.value.ai_prompt};h.value==="add"?await i.createTask(e)?(m.success("任务创建成功"),d.value=!1):m.error("任务创建失败"):k.value&&(await i.updateTask(k.value.id,e)?(m.success("任务更新成功"),d.value=!1):m.error("任务更新失败"))},oe=async e=>{(e.enabled?await i.disableTask(e.id):await i.enableTask(e.id))?m.success(e.enabled?"已禁用":"已启用"):m.error("操作失败")},ae=async e=>{m.info(`正在检测 "${e.name}"...`);const t=await i.checkTask(e.id);t?t.error?m.error(`检测失败: ${t.error}`):t.changed?m.success("检测到变化！"):m.info("未检测到变化"):m.error("检测请求失败")},ie=async e=>{await i.deleteTask(e.id)?m.success("删除成功"):m.error("删除失败")};return be(async()=>{await $()}),(e,t)=>(z(),O("div",lt,[n(l(Be),{show:p.value},{default:o(()=>[n(l(Me),null,{header:o(()=>[n(l(b),{justify:"space-between",align:"center",style:{width:"100%"}},{default:o(()=>[n(l(b),{align:"center"},{default:o(()=>[t[14]||(t[14]=g("span",{class:"page-title"},"任务管理",-1)),l(s).isConnected?(z(),_e(l(B),{key:0,trigger:"hover"},{trigger:o(()=>[n(l(R),{type:"success",size:"small",round:""},{icon:o(()=>[n(l(x),null,{default:o(()=>[n(l(Ne))]),_:1})]),default:o(()=>[t[12]||(t[12]=N(" 实时更新 ",-1))]),_:1})]),default:o(()=>[t[13]||(t[13]=g("span",null,"任务状态将自动同步更新",-1))]),_:1})):Pe("",!0)]),_:1}),n(l(b),null,{default:o(()=>[n(l(y),{type:"primary",onClick:le},{icon:o(()=>[n(l(x),null,{default:o(()=>[n(l(Ae))]),_:1})]),default:o(()=>[t[15]||(t[15]=N(" 添加任务 ",-1))]),_:1}),n(l(y),{quaternary:"",circle:"",onClick:te},{icon:o(()=>[n(l(x),null,{default:o(()=>[n(l(Le))]),_:1})]),_:1})]),_:1})]),_:1})]),default:o(()=>[n(l(b),{style:{"margin-bottom":"16px"}},{default:o(()=>[n(l(S),{value:w.value,"onUpdate:value":t[0]||(t[0]=u=>w.value=u),placeholder:"搜索任务名称、URL或描述",clearable:"",style:{width:"300px"}},{prefix:o(()=>[n(l(x),null,{default:o(()=>[n(l(Ue))]),_:1})]),_:1},8,["value"]),n(l(Re),{value:f.value,"onUpdate:value":t[1]||(t[1]=u=>f.value=u),options:j,style:{width:"150px"},placeholder:"状态筛选"},null,8,["value"])]),_:1}),n(l(qe),{columns:ee,data:v.value,bordered:!1,"single-line":!1,"row-key":u=>u.id,"scroll-x":1100,"max-height":"calc(100vh - 320px)"},null,8,["data","row-key"]),n(l(b),{style:{"margin-top":"16px"}},{default:o(()=>[n(l(Ce),{depth:"3"},{default:o(()=>[N(" 共 "+M(l(i).total)+" 个任务， "+M(l(i).activeCount)+" 个启用， "+M(l(i).errorCount)+" 个错误 ",1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(l(ze),{show:d.value,"onUpdate:show":t[11]||(t[11]=u=>d.value=u),title:h.value==="add"?"添加任务":"编辑任务",preset:"card",style:{width:"600px"},"mask-closable":!1},{footer:o(()=>[n(l(b),{justify:"end"},{default:o(()=>[n(l(y),{onClick:t[10]||(t[10]=u=>d.value=!1)},{default:o(()=>[...t[19]||(t[19]=[N("取消",-1)])]),_:1}),n(l(y),{type:"primary",onClick:re,loading:l(i).loading},{default:o(()=>[N(M(h.value==="add"?"添加":"保存"),1)]),_:1},8,["loading"])]),_:1})]),default:o(()=>[n(l($e),{ref_key:"formRef",ref:P,model:a.value,rules:Y,"label-placement":"left","label-width":"100","require-mark-placement":"right-hanging"},{default:o(()=>[n(l(T),{label:"任务名称",path:"name"},{default:o(()=>[n(l(S),{value:a.value.name,"onUpdate:value":t[2]||(t[2]=u=>a.value.name=u),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),n(l(T),{label:"网页URL",path:"url"},{default:o(()=>[n(l(S),{value:a.value.url,"onUpdate:value":t[3]||(t[3]=u=>a.value.url=u),placeholder:"https://example.com"},null,8,["value"])]),_:1}),n(l(T),{label:"任务描述",path:"description"},{default:o(()=>[n(l(S),{value:a.value.description,"onUpdate:value":t[4]||(t[4]=u=>a.value.description=u),type:"textarea",placeholder:"任务描述，用于AI分析时的上下文",rows:2},null,8,["value"])]),_:1}),n(l(T),{label:"CSS选择器",path:"selectors"},{default:o(()=>[n(l(S),{value:a.value.selectors,"onUpdate:value":t[5]||(t[5]=u=>a.value.selectors=u),placeholder:"多个选择器用逗号分隔，如: .content, #main"},null,8,["value"])]),_:1}),n(l(T),{label:"检测间隔",path:"interval"},{default:o(()=>[n(l(W),{value:a.value.interval,"onUpdate:value":t[6]||(t[6]=u=>a.value.interval=u),min:10,max:86400,style:{width:"100%"}},{suffix:o(()=>[...t[16]||(t[16]=[N("秒",-1)])]),_:1},8,["value"])]),_:1}),n(l(T),{label:"超时时间",path:"timeout"},{default:o(()=>[n(l(W),{value:a.value.timeout,"onUpdate:value":t[7]||(t[7]=u=>a.value.timeout=u),min:1e3,max:12e4,step:1e3,style:{width:"100%"}},{suffix:o(()=>[...t[17]||(t[17]=[N("毫秒",-1)])]),_:1},8,["value"])]),_:1}),n(l(T),{label:"启用状态"},{default:o(()=>[n(l(Ie),{value:a.value.enabled,"onUpdate:value":t[8]||(t[8]=u=>a.value.enabled=u)},null,8,["value"])]),_:1}),n(l(Oe),{style:{margin:"16px 0"}},{default:o(()=>[...t[18]||(t[18]=[N("AI 配置",-1)])]),_:1}),n(l(T),{label:"自定义提示词",path:"ai_prompt"},{default:o(()=>[n(l(S),{value:a.value.ai_prompt,"onUpdate:value":t[9]||(t[9]=u=>a.value.ai_prompt=u),type:"textarea",placeholder:nt,rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}}),pt=Te(rt,[["__scopeId","data-v-97085e1c"]]);export{pt as default};
